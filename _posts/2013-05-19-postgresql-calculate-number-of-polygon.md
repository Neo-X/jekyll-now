---
layout: post
title: 'Postgresql: Calculate the number of polygon islands or overlapping groups'
date: '2013-05-19T12:03:00.001-07:00'
author: Glen B
tags: 
modified_time: '2013-05-26T17:08:17.861-07:00'
blogger_id: tag:blogger.com,1999:blog-2030049895335802245.post-5455322550022455382
blogger_orig_url: http://fracturedplane.blogspot.com/2013/05/postgresql-calculate-number-of-polygon.html
---

This post is about some work I did on how to calculate the number of number of groups of intersecting polygons in an array of polygons in Postgresql<br /><br /><br />First lets be a little more strict about what the definition of an island is. For the purposes of this algorithm an island consists of a set polygons where at least one polygon in the set overlaps another in the set. <br /><br /><br />I created a function to calculate the number of islands attached is the plpgsql code for the function.<br /><br /><pre class="prettyprint"><code class="language-sql"><br />CREATE OR REPLACE FUNCTION getNumIslands(polys polygon[]) RETURNS INT AS<br />$BODY$<br />DECLARE<br />islandList polygon[]; -- holds the set of obstacles that make up the current island.<br />islandCount INT; -- holds the count of the number of islands.<br />poly polygon; -- holds the polygon to start an island search<br />polys_copy polygon[]; -- A copy of the input list<br />inddex INT; -- keeps track of the current index in the polys_copy search<br /><br />BEGIN<br />&nbsp;&nbsp;&nbsp; <br />islandCount := 0;<br /><br />islandList := polys;<br />polys_copy := polys;<br />inddex := 1;<br /><br />WHILE array_length(polys_copy,1) &gt; 0<br />LOOP<br />&nbsp;&nbsp;&nbsp; -- RAISE NOTICE 'Poly_list length is: %', array_length(polys_copy, 1);<br />&nbsp;&nbsp;&nbsp; -- grab the first poly<br />&nbsp;&nbsp;&nbsp; poly := polys_copy[1];<br />&nbsp;&nbsp;&nbsp; islandList := array_append(ARRAY[]::polygon[], poly);<br />&nbsp;&nbsp;&nbsp; -- RAISE NOTICE 'Current island is %', islandList;<br />&nbsp;&nbsp;&nbsp; -- remove the first poly because we dont care about it overlaping itself.<br />&nbsp;&nbsp;&nbsp; polys_copy := polys_copy[2:array_length(polys_copy, 1)];<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; -- Make a list of all the polys left that overlap with poly<br />&nbsp;&nbsp;&nbsp; WHILE inddex &lt;= array_length(polys_copy, 1)<br />&nbsp;&nbsp;&nbsp; LOOP<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -- If the poly_copy overlaps the poly then add its index to the list<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -- of polys to be removed<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FOREACH poly IN ARRAY islandList<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LOOP<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; IF polys_copy[inddex] &amp;&amp; poly<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; THEN<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; islandList := array_append(islandList, polys_copy[inddex]);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; --<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; IF array_length(polys_copy,1) = 1<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; THEN<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; polys_copy := null;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ELSE<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; polys_copy := polys_copy[1:inddex-1] || polys_copy[inddex+1:array_length(polys_copy, 1)];<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; END IF;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -- RAISE NOTICE 'Intersects with poly index: %', inddex;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -- When a new intersecting poly is found it needs to be compared<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -- to every poly not just the polys left in the list<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; inddex := 0;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; EXIT;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; END IF;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; END LOOP;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -- RAISE NOTICE 'Current island is %', islandList;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; inddex := inddex + 1;<br />&nbsp;&nbsp;&nbsp; END LOOP;<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; islandCount := islandCount + 1;<br />&nbsp;&nbsp;&nbsp; inddex := 1;<br />END LOOP;<br /><br />RETURN islandCount;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />END<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />$BODY$ LANGUAGE plpgsql;</code></pre>Â© 2013 Glen Berseth | www.fracturedplane.com 