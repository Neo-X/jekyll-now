---
layout: post
title: Python and TCP/IP
date: '2013-02-20T18:06:00.001-08:00'
author: Glen B
tags: 
modified_time: '2013-03-08T08:02:18.238-08:00'
blogger_id: tag:blogger.com,1999:blog-2030049895335802245.post-6187533957253832139
blogger_orig_url: http://fracturedplane.blogspot.com/2013/02/python-and-tcpip.html
---

TCP/IP in Python<br /><br />Some notes on how TCP/IP works in Python (2.7).<br /><br />Basic TCP client<br /><br /><br /><pre class="prettyprint"><code class="language-py"><br /><code>import socket<br />import sys<br /><br /># Create a TCP/IP socket<br />sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br /><br /># Connect the socket to the port where the server is listening<br />server_address = ('localhost', 10000)<br />print &gt;&gt;sys.stderr, 'connecting to %s port %s' % server_address<br />sock.connect(server_address)<br /><br />try:<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; # Send data<br />&nbsp;&nbsp;&nbsp; message = 'This is the message.&nbsp; It will be repeated.'<br />&nbsp;&nbsp;&nbsp; print &gt;&gt;sys.stderr, 'sending "%s"' % message<br />&nbsp;&nbsp;&nbsp; sock.sendall(message)<br /><br />&nbsp;&nbsp;&nbsp; # Look for the response<br />&nbsp;&nbsp;&nbsp; amount_received = 0<br />&nbsp;&nbsp;&nbsp; amount_expected = len(message)<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; while amount_received &lt; amount_expected:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data = sock.recv(16)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amount_received += len(data)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print &gt;&gt;sys.stderr, 'received "%s"' % data<br /><br />finally:<br />&nbsp;&nbsp;&nbsp; print &gt;&gt;sys.stderr, 'closing socket'<br />&nbsp;&nbsp;&nbsp; sock.close()</code></code></pre><br /><br />This client is simple and easy to use but I need something that would not block at all. To achieve this Python has a feature called <a href="http://docs.python.org/2/library/select.html" target="_blank">select</a> that can be used on stream like object that have a file descriptor. This selector can be used to check if the selector object has data ready for reading, writing or an exceptional condition (exceptional conditions not covered here).<br /><br /><pre class="prettyprint"><code class="language-py"><br />import select<br />import socket<br />import sys<br /><br />service = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br /><br /># Connect the socket to the port where the server is listening<br />server_address = ('localhost', 10000)<br />print &gt;&gt; sys.stderr, 'connecting to %s port %s' % server_address<br />service.connect(server_address)</code></pre><br /><br /><br />This beginning stays the same but now the method to receive has changed.<br /><br /><pre class="prettyprint"><code class="language-py"><br />&nbsp;r, w, e = select.select([service], [], [], 0.0)<br />&nbsp;&nbsp;&nbsp; if r: # There is something to read<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data = service.recv(256)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; character = 'ChrBrad0'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bmlMessage = data<locomotion manner="jog" target="' + data + ' 0'+ '" type="basic"><locomotion manner="jog" target="' + data + ' 0'+ '" type="basic"></locomotion><br /></locomotion></code></pre><br /><br /><br /><br /><br /><br /><br />